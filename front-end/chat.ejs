<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Private Chat</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" href="../../css/global.css">
        <link rel="stylesheet" type="text/css" href="../../css/chat.css">
        <link rel="stylesheet" type="text/css" href="../../css/forms.css">
    </head>
    <body> 
        <div id="menu">
            <a class="menu--item" href="/users/<%=user._id%>"><i class="fas fa-cogs"></i></a>
            <a class="menu--item" href="/logout"><i class="fas fa-sign-out-alt"></i></a>
            <a class="menu--item" href="/app/newroom"><i class="fas fa-plus"></i></a>
        </div>

        <!-- To add a new user to the room, displayed if we aren't in general -->
        <% if(room != 1) { %>
            <div id="addUserFormContainer" class="ohwowlookitsgone">
                <form id="form">
                    <h1>Add User</h1>
                    <button id="close"><i class="fas fa-times"></i></button>
                    <input  class="addUserForm--input" type="text" name="username" id="addUserInput" placeholder="Username">
                    <button class="addUserForm--btn">Add User</button>
                </form>
            </div>
        <% } %>



        <!-- This'll contain both our sidebar showing all chatrooms the user has available and the actual current chatroom. -->
        <div id="contentWrapper">

            <!-- This'll contain all the chatrooms the user has available. -->
            <ul class="sidebar">
                <li class="sidebarHeader">
                    <h2>Your Rooms</h2>
                </li>
                <li class="sidebarChatroom">
                    <a href="/app/rooms/1">
                        <p class="chatroomName">Global</p>
                    </a>
                </li>
                <% rooms.forEach(chatroom => { %>
                    <li class="sidebarChatroom">
                        <a href="/app/rooms/<%=chatroom._id%>">
                            <p class="chatroomName"><%=chatroom.name%></p>
                        </a>
                    </li>
                <% }) %>
            </ul>


            
            <!-- Right now just append all the messages like below but without the distinction between private and general -->
            <div id="mainDisplay">
                <!-- To add a new user to the room, displayed if we aren't in general -->
                <% if(room != 1) { %>
                    <button class="addUserBtn"><i class="fas fa-user-plus"></i></button>
                <% } %>
                <ul class="messages">
                    <% msgs.forEach(msg => { %>
                        <li>
                            <img src="<%=msg.pfp%>" alt="pfp" class="pfp">
                            <div class="messageDiv">
                                <span>
                                    <p style="color:<%=msg.colour%>;"class="messageAuthor"><%=msg.username%></p>
                                    <% if (msg.authorid == user._id) { %>
                                        <div class="options">
                                            <p><%=msg._id%></p>
                                            <button class="delete"><i class="fas fa-trash-alt"></i></button>
                                        </div>
                                    <% } %>
                                </span>
                                <p class="messageContent"><%=msg.message%></p>
                            </div>
                        </li>
                    <% }) %>
                </ul>
            </div>
        </div>

        
        <form id="messaging" action="">
            <input id="input" autocomplete="off"/>
            <button id="send">Send</button>
        </form>


        <script>
            // EJS looks kind of ugly. We'll pass the necessary info to our
            // chat.js file in the following, hack-y way.
            const username = "<%=user.username%>";
            const userId = <%=user._id%>;
            const pfp = "<%=user.pfp%>";
            const colour = "<%=user.colour%>"
            const room = <%=room%>;
                // Whatever is within these script tags, is now accessable within
                // all our script tags, including the chat.js file, which is in a
                // script tag right down below.
        </script>


        <!-- This script tag is needed in order to use socket.js on the client-side -->
        <script type="text/javascript" src="/socket.io/socket.io.js"></script>

        <!-- This is the actual messing about we do using the socket.io capabilities -->
        <script type="text/javascript" src="/js/chat.js"></script>
        
        <!-- FontAwesome stuff -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">
    </body>
</html>